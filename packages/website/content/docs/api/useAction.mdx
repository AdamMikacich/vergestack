---
title: useAction
---

The `useAction` hook is a powerful utility for handling asynchronous actions in React applications. It provides a convenient way to manage loading states, errors, and data fetching while executing API calls or other asynchronous operations.

## Usage

<Tabs items={['Greeting.tsx', 'action.ts']}>
  <Tab value="Greeting.tsx">

    ```tsx
    import { useAction } from '@vergestack/api-react';

    function Greeting() {
      const { data, errors, execute } = useAction(greetAction);
      const [name, setName] = useState('');

      return <div>
        <input name="name" value={name} onChange={(e) => setName(e.target.value)} />
        <button type="submit" onClick={() => execute(name)}>Greet</button>
        {data && <p>{data}</p>}
        {errors && <p>{errors[0]?.message}</p>}
      </div>
    }
    ```

  </Tab>
  <Tab value="action.ts">
  
    ```ts
    import { createAction } from '@vergestack/api';
    import { z } from 'zod';

    export const greetAction = createAction()
      .input(z.string())
      .output(z.string())
      .handler(async (name) => {
        return `Hello, ${name}!`;
      });
    ```

</Tab>
</Tabs>

## Parameters

- `action`: An action created using the `createAction` function from `@vergestack/api`.

## Return Value

The `useAction` hook returns an object with the following properties:

- `loading`: A boolean indicating whether the asynchronous operation is in progress.
- `errors`: An array of `ErrorMessage` objects if the asynchronous operation fails.
- `data`: The data returned by the asynchronous operation (type `OutputType | null`).
- `status`: The HTTP status code of the response (type `StatusCodes | null`).
- `ok`: A boolean indicating if the status is `StatusCodes.OK`.
- `execute`: A function to manually trigger the execution of the asynchronous operation.
- `executeForm`: A function to execute the action with `FormData` input.
- `getFormError`: A function to retrieve form-specific errors.

## Detailed Usage

### Basic Execution

```tsx
import { createAction } from '@vergestack/api';
import { z } from 'zod';

const fetchUserAction = createAction()
  .input(z.object({ id: z.string() }))
  .output(z.object({ name: z.string(), age: z.number() }))
  .handler(async (input) => {
    const response = await fetch(`https://api.example.com/user/${input.id}`);
    return response.json();
  });

function UserComponent() {
  const { data, loading, errors, execute } = useAction(fetchUserAction);

  useEffect(() => {
    execute({ id: 'user-123' });
  }, [execute]);

  // ... render component using data, loading, and errors
}
```

### Form Handling

```tsx
import { createAction } from '@vergestack/api';
import { z } from 'zod';

const submitFormAction = createAction()
  .input(z.object({ username: z.string(), password: z.string() }))
  .output(z.object({ success: z.boolean() }))
  .handler(async (input) => {
    // Perform form submission logic here
    return { success: true };
  });

function FormComponent() {
  const { executeForm, getFormError } = useAction(submitFormAction);

  const handleSubmit = (event) => {
    event.preventDefault();
    const formData = new FormData(event.target);
    executeForm(formData);
  };

  return (
    <form onSubmit={handleSubmit}>
      <input name="username" />
      {getFormError('username') && <span>{getFormError('username')}</span>}
      <input name="password" type="password" />
      {getFormError('password') && <span>{getFormError('password')}</span>}
      <button type="submit">Submit</button>
    </form>
  );
}
```

## Error Handling

The hook automatically handles errors and provides them in the `errors` array. It also integrates with a global error handler through the `ApiContext`.

## Notes

- The `execute` function can be called manually to start the asynchronous operation.
- The `loading` state is `true` while the asynchronous operation is in progress.
- The `errors` state contains an array of error messages if the asynchronous operation fails.
- The `data` state is updated with the result of the asynchronous operation once it completes successfully.
- The `ok` state is `true` when the status is `StatusCodes.OK`.
- The `executeForm` function can be used to easily submit form data.
- The `getFormError` function allows you to retrieve specific error messages for form fields.

By using the `useAction` hook, you can manage asynchronous operations in a clean and organized manner, making your code more maintainable and easier to understand.
